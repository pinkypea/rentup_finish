{"ast":null,"code":"var _jsxFileName = \"D:\\\\rentup\\\\src\\\\store\\\\auth-context.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nlet logoutTimer;\nconst AuthContext = /*#__PURE__*/React.createContext({\n  token: '',\n  isLoggedIn: false,\n  role: 'user',\n  changeRole: switchRole => {},\n  login: token => {},\n  logout: () => {}\n});\nconst calculateRemainingTime = expirationTime => {\n  const currentTime = new Date().getTime();\n  const adjExpirationTime = new Date(expirationTime).getTime();\n  const remainingDuration = adjExpirationTime - currentTime;\n  return remainingDuration;\n};\nconst retrieveStoredToken = () => {\n  const storedToken = localStorage.getItem('token');\n  const storedExpirationDate = localStorage.getItem('expirationTime');\n  const remainingTime = calculateRemainingTime(storedExpirationDate);\n  if (remainingTime <= 3600) {\n    localStorage.removeItem('token');\n    localStorage.removeItem('expirationTime');\n    return null;\n  }\n  return {\n    token: storedToken,\n    duration: remainingTime\n  };\n};\nexport const AuthContextProvider = props => {\n  _s();\n  const tokenData = retrieveStoredToken();\n  let initialToken;\n  if (tokenData) {\n    initialToken = tokenData.token;\n  }\n  const [token, setToken] = useState(initialToken);\n  const userIsLoggedIn = !!token;\n  const logoutHandler = useCallback(() => {\n    setToken(null);\n    localStorage.removeItem('token');\n    localStorage.removeItem('expirationTime');\n    if (logoutTimer) {\n      clearTimeout(logoutTimer);\n    }\n  }, []);\n  const loginHandler = (token, expirationTime) => {\n    setToken(token);\n    localStorage.setItem('token', token);\n    localStorage.setItem('expirationTime', expirationTime);\n    const remainingTime = calculateRemainingTime(expirationTime);\n    logoutTimer = setTimeout(logoutHandler, remainingTime);\n  };\n  useEffect(() => {\n    if (tokenData) {\n      console.log(tokenData.duration);\n      logoutTimer = setTimeout(logoutHandler, tokenData.duration);\n    }\n  }, [tokenData, logoutHandler]);\n  const [role, setRole] = useState('user');\n  const changeRoleHandler = switchRole => {\n    if (switchRole === true) {\n      setRole('user');\n    } else {\n      setRole('landlord');\n    }\n  };\n  const contextValue = {\n    token: token,\n    isLoggedIn: userIsLoggedIn,\n    role: role,\n    changeRole: changeRoleHandler,\n    login: loginHandler,\n    logout: logoutHandler\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: contextValue,\n    children: props.children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 101,\n    columnNumber: 9\n  }, this);\n};\n_s(AuthContextProvider, \"eVTLca2q2ZYN9BOWFROrGh/DZgI=\");\n_c = AuthContextProvider;\nexport default AuthContext;\nvar _c;\n$RefreshReg$(_c, \"AuthContextProvider\");","map":{"version":3,"names":["React","useState","useEffect","useCallback","logoutTimer","AuthContext","createContext","token","isLoggedIn","role","changeRole","switchRole","login","logout","calculateRemainingTime","expirationTime","currentTime","Date","getTime","adjExpirationTime","remainingDuration","retrieveStoredToken","storedToken","localStorage","getItem","storedExpirationDate","remainingTime","removeItem","duration","AuthContextProvider","props","tokenData","initialToken","setToken","userIsLoggedIn","logoutHandler","clearTimeout","loginHandler","setItem","setTimeout","console","log","setRole","changeRoleHandler","contextValue","children"],"sources":["D:/rentup/src/store/auth-context.js"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\r\n\r\nlet logoutTimer;\r\n\r\nconst AuthContext = React.createContext({\r\n    token: '',\r\n    isLoggedIn: false,\r\n    role: 'user',\r\n    changeRole: (switchRole) => {},\r\n    login: (token) => {},\r\n    logout: () => {},\r\n});\r\n\r\nconst calculateRemainingTime = (expirationTime) => {\r\n    const currentTime = new Date().getTime();\r\n    const adjExpirationTime = new Date(expirationTime).getTime();\r\n\r\n    const remainingDuration = adjExpirationTime - currentTime;\r\n\r\n    return remainingDuration;\r\n};\r\n\r\nconst retrieveStoredToken = () => {\r\n    const storedToken = localStorage.getItem('token');\r\n    const storedExpirationDate = localStorage.getItem('expirationTime');\r\n\r\n    const remainingTime = calculateRemainingTime(storedExpirationDate);\r\n\r\n    if (remainingTime <= 3600) {\r\n        localStorage.removeItem('token');\r\n        localStorage.removeItem('expirationTime');\r\n        return null;\r\n    }\r\n\r\n    return {\r\n        token: storedToken,\r\n        duration: remainingTime,\r\n    };\r\n};\r\n\r\nexport const AuthContextProvider = (props) => {\r\n    const tokenData = retrieveStoredToken();\r\n    \r\n    let initialToken;\r\n    if (tokenData) {\r\n        initialToken = tokenData.token;\r\n    }\r\n\r\n    const [token, setToken] = useState(initialToken);\r\n\r\n    const userIsLoggedIn = !!token;\r\n\r\n    const logoutHandler = useCallback(() => {\r\n        setToken(null);\r\n        localStorage.removeItem('token');\r\n        localStorage.removeItem('expirationTime');\r\n\r\n        if (logoutTimer) {\r\n            clearTimeout(logoutTimer);\r\n        }\r\n    }, []);\r\n\r\n    const loginHandler = (token, expirationTime) => {\r\n        setToken(token);\r\n        localStorage.setItem('token', token);\r\n        localStorage.setItem('expirationTime', expirationTime);\r\n\r\n        const remainingTime = calculateRemainingTime(expirationTime);\r\n\r\n        logoutTimer = setTimeout(logoutHandler, remainingTime);\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (tokenData) {\r\n            console.log(tokenData.duration);\r\n            logoutTimer = setTimeout(logoutHandler, tokenData.duration);\r\n        }\r\n    }, [tokenData, logoutHandler]);\r\n    \r\n    const [role, setRole] = useState('user')\r\n    \r\n    const changeRoleHandler = (switchRole) => {\r\n        if (switchRole === true) {\r\n            setRole('user')\r\n        }else{\r\n            setRole('landlord')\r\n        }\r\n    }\r\n\r\n    const contextValue = {\r\n        token: token,\r\n        isLoggedIn: userIsLoggedIn,\r\n        role: role,\r\n        changeRole: changeRoleHandler,\r\n        login: loginHandler,\r\n        logout: logoutHandler,\r\n    };\r\n    \r\n\r\n    return (\r\n        <AuthContext.Provider value={contextValue}>\r\n            {props.children}\r\n        </AuthContext.Provider>\r\n    );\r\n};\r\n\r\nexport default AuthContext;"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,QAAQ,EAAEC,SAAS,EAAEC,WAAW,QAAQ,OAAO;AAAC;AAEhE,IAAIC,WAAW;AAEf,MAAMC,WAAW,gBAAGL,KAAK,CAACM,aAAa,CAAC;EACpCC,KAAK,EAAE,EAAE;EACTC,UAAU,EAAE,KAAK;EACjBC,IAAI,EAAE,MAAM;EACZC,UAAU,EAAGC,UAAU,IAAK,CAAC,CAAC;EAC9BC,KAAK,EAAGL,KAAK,IAAK,CAAC,CAAC;EACpBM,MAAM,EAAE,MAAM,CAAC;AACnB,CAAC,CAAC;AAEF,MAAMC,sBAAsB,GAAIC,cAAc,IAAK;EAC/C,MAAMC,WAAW,GAAG,IAAIC,IAAI,EAAE,CAACC,OAAO,EAAE;EACxC,MAAMC,iBAAiB,GAAG,IAAIF,IAAI,CAACF,cAAc,CAAC,CAACG,OAAO,EAAE;EAE5D,MAAME,iBAAiB,GAAGD,iBAAiB,GAAGH,WAAW;EAEzD,OAAOI,iBAAiB;AAC5B,CAAC;AAED,MAAMC,mBAAmB,GAAG,MAAM;EAC9B,MAAMC,WAAW,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;EACjD,MAAMC,oBAAoB,GAAGF,YAAY,CAACC,OAAO,CAAC,gBAAgB,CAAC;EAEnE,MAAME,aAAa,GAAGZ,sBAAsB,CAACW,oBAAoB,CAAC;EAElE,IAAIC,aAAa,IAAI,IAAI,EAAE;IACvBH,YAAY,CAACI,UAAU,CAAC,OAAO,CAAC;IAChCJ,YAAY,CAACI,UAAU,CAAC,gBAAgB,CAAC;IACzC,OAAO,IAAI;EACf;EAEA,OAAO;IACHpB,KAAK,EAAEe,WAAW;IAClBM,QAAQ,EAAEF;EACd,CAAC;AACL,CAAC;AAED,OAAO,MAAMG,mBAAmB,GAAIC,KAAK,IAAK;EAAA;EAC1C,MAAMC,SAAS,GAAGV,mBAAmB,EAAE;EAEvC,IAAIW,YAAY;EAChB,IAAID,SAAS,EAAE;IACXC,YAAY,GAAGD,SAAS,CAACxB,KAAK;EAClC;EAEA,MAAM,CAACA,KAAK,EAAE0B,QAAQ,CAAC,GAAGhC,QAAQ,CAAC+B,YAAY,CAAC;EAEhD,MAAME,cAAc,GAAG,CAAC,CAAC3B,KAAK;EAE9B,MAAM4B,aAAa,GAAGhC,WAAW,CAAC,MAAM;IACpC8B,QAAQ,CAAC,IAAI,CAAC;IACdV,YAAY,CAACI,UAAU,CAAC,OAAO,CAAC;IAChCJ,YAAY,CAACI,UAAU,CAAC,gBAAgB,CAAC;IAEzC,IAAIvB,WAAW,EAAE;MACbgC,YAAY,CAAChC,WAAW,CAAC;IAC7B;EACJ,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMiC,YAAY,GAAG,CAAC9B,KAAK,EAAEQ,cAAc,KAAK;IAC5CkB,QAAQ,CAAC1B,KAAK,CAAC;IACfgB,YAAY,CAACe,OAAO,CAAC,OAAO,EAAE/B,KAAK,CAAC;IACpCgB,YAAY,CAACe,OAAO,CAAC,gBAAgB,EAAEvB,cAAc,CAAC;IAEtD,MAAMW,aAAa,GAAGZ,sBAAsB,CAACC,cAAc,CAAC;IAE5DX,WAAW,GAAGmC,UAAU,CAACJ,aAAa,EAAET,aAAa,CAAC;EAC1D,CAAC;EAEDxB,SAAS,CAAC,MAAM;IACZ,IAAI6B,SAAS,EAAE;MACXS,OAAO,CAACC,GAAG,CAACV,SAAS,CAACH,QAAQ,CAAC;MAC/BxB,WAAW,GAAGmC,UAAU,CAACJ,aAAa,EAAEJ,SAAS,CAACH,QAAQ,CAAC;IAC/D;EACJ,CAAC,EAAE,CAACG,SAAS,EAAEI,aAAa,CAAC,CAAC;EAE9B,MAAM,CAAC1B,IAAI,EAAEiC,OAAO,CAAC,GAAGzC,QAAQ,CAAC,MAAM,CAAC;EAExC,MAAM0C,iBAAiB,GAAIhC,UAAU,IAAK;IACtC,IAAIA,UAAU,KAAK,IAAI,EAAE;MACrB+B,OAAO,CAAC,MAAM,CAAC;IACnB,CAAC,MAAI;MACDA,OAAO,CAAC,UAAU,CAAC;IACvB;EACJ,CAAC;EAED,MAAME,YAAY,GAAG;IACjBrC,KAAK,EAAEA,KAAK;IACZC,UAAU,EAAE0B,cAAc;IAC1BzB,IAAI,EAAEA,IAAI;IACVC,UAAU,EAAEiC,iBAAiB;IAC7B/B,KAAK,EAAEyB,YAAY;IACnBxB,MAAM,EAAEsB;EACZ,CAAC;EAGD,oBACI,QAAC,WAAW,CAAC,QAAQ;IAAC,KAAK,EAAES,YAAa;IAAA,UACrCd,KAAK,CAACe;EAAQ;IAAA;IAAA;IAAA;EAAA,QACI;AAE/B,CAAC;AAAC,GAhEWhB,mBAAmB;AAAA,KAAnBA,mBAAmB;AAkEhC,eAAexB,WAAW;AAAC;AAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}